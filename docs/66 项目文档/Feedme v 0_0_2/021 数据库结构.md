# 数据库结构

版本：v 0.0.1

## 表清单

| 表名 | 中文                                 | 说明             |
| ---- | ------------------------------------ | ---------------- |
| ods_baostock_cnstock_k_d  | Baostock A股日线数据表 |  |
| ods_baostock_stock_basic  | Baostock 证券基本资料表 |  |
| ods_efinance_cnstock_k_d | efinance A股日线数据表 | |
| ods_efinance_cnstock_list | efinance A股清单 | |
| ods_tushare_trade_cal | tushare 交易日历 |  |
| ods_ds_stat | 数据源数据统计表 | 存放每一项数据本地下载情况 |
| dwd_dtsrc_stat | 数据源统计表 | |

## 表结构

### ods_baostock_cnstock_k_d

表：Baostock A股日线数据表

| 字段名 | 类型 | 约束 | 说明 | Sample Data |
| ------ | ---- | ---- | ---- | ----------- |
| trade_date | varchar(10) | PK1 | 交易日期 | 2017-07-07 |
| code | varchar(10) | PK2 | 证券代码 | 600000.SH |
| open | decimal(12, 2) |  | 开盘价 | 12.34 |
| high | decimal(12, 2) |  | 最高价 | 12.34 |
| low | decimal(12, 2) |  | 最低价 | 12.34 |
| close | decimal(12, 2) |  | 收盘价 | 12.34 |
| preclose | decimal(12, 2) |  | 前收盘价 | 12.34 |
| volume | decimal(12, 2) |  | 成交量（累计 单位：股） | 12.34 |
| amount | decimal(12, 2) |  | 成交额（单位：人民币元） | 12.34 |
| adjustflag | integer |  | 复权状态(1：后复权， 2：前复权，3：不复权） | 12.34 |
| turn | decimal(12, 6) |  | 换手率, [指定交易日的成交量(股)/指定交易日的股票的流通股总股数(股)]*100% | 0.087772 |
| tradestatus | integer |  | 交易状态(1：正常交易 0：停牌） | 12.34 |
| pctChg | decimal(12, 6) |  | 涨跌幅（百分比） | —0.473929 |
| isST | integer |  | 是否ST股，1是，0否 | 1 |

```sql
CREATE TABLE ods_baostock_cnstock_k_d (
    trade_date    VARCHAR (20)  NOT NULL,
    code          VARCHAR (20)  NOT NULL,
    open          decimal(16, 2),
    high          decimal(16, 2),
    low           decimal(16, 2),
    close         decimal(16, 2),
    preclose      decimal(16, 2),
    volume        decimal(16, 2),
    amount        decimal(16, 2),
    adjustflag    int,
    turn          decimal(16, 2),
    tradestatus   int,
    pctChg        decimal(12, 6),

    isST          int,
    
    
    PRIMARY KEY (
        trade_date, code
    )
);
```

### ods_baostock_stock_basic

| 字段名 | 类型 | 约束 | 说明 | Sample Data |
| ------ | ---- | ---- | ---- | ----------- |
| code | varchar(10) | PK | 证券代码 | 600000.SH |
| code_name | varchar(50) |  | 证券名称 |  |
| ipoDate | varchar(10) |  | 上市日期 |  |
| outDate | varchar(10) |  | 退市日期 |  |
| type_id | varchar(1) |  | 证券类型，其中1：股票，2：指数，3：其它，4：可转债，5：ETF |  |
| status | varchar(1) |  | 上市状态，其中1：上市，0：退市 |  |

```sql
CREATE TABLE ods_baostock_stock_basic (
    code          VARCHAR (20)  NOT NULL,
    code_name     VARCHAR (50),
    ipoDate       VARCHAR (50),
    outDate       VARCHAR (50),
    type_id       VARCHAR (50),
    status_id     VARCHAR (50),
    
    PRIMARY KEY (
        code
    )
);
```

### ods_efinance_cnstock_k_d

表：efinance A股日线数据表

| 字段名     | 类型           | 约束 | 说明                     | Sample Data |
| ---------- | -------------- | ---- | ------------------------ | ----------- |
| stock_name | varchar(10)    |      | 股票名称                 | 贵州茅台    |
| stock_id   | varchar(10)    | PK1  | 股票代码                 | 600000.SH   |
| trade_date | varchar(10)    | PK2  | 日期                     | 2021-01-04  |
| open       | decimal(12, 2) |      | 开盘                     | 12.34       |
| high       | decimal(12, 2) |      | 最高                     | 12.34       |
| low        | decimal(12, 2) |      | 最低                     | 12.34       |
| close      | decimal(12, 2) |      | 收盘                     | 12.34       |
| volume     | decimal(12, 2) |      | 成交量（累计 单位：股）  | 12.34       |
| amount     | decimal(12, 2) |      | 成交额（单位：人民币元） | 12.34       |
| amp        | decimal(12, 6) |      | 振幅                     |             |
| pctChg     | decimal(12, 6) |      | 涨跌幅（百分比）         | -0.473929   |
| amtChg     | decimal(12, 6) |      | 涨跌额                   |             |
| turn       | decimal(12, 6) |      | 换手率                   |             |

```sql
CREATE TABLE ods_efinance_cnstock_k_d (
    stock_name    VARCHAR(20)   NOT NULL,
    stock_id      VARCHAR(10)   NOT NULL,
    trade_date    VARCHAR(10)  NOT NULL,
    open          decimal(16, 2),
    high          decimal(16, 2),
    low           decimal(16, 2),
    close         decimal(16, 2),
    volume        decimal(16, 2),
    amount        decimal(16, 2),
    amp           decimal(16, 2),
    pctChg        decimal(12, 6),
    amtChg        decimal(16, 2),
    turn          decimal(16, 2),   
    
    PRIMARY KEY (
        stock_id, trade_date
    )
);
```

### ods_efinance_cnstock_list

表：efinance A股清单

| 字段名     | 类型        | 约束 | 说明     | Sample Data |
| ---------- | ----------- | ---- | -------- | ----------- |
| stock_name | varchar(10) |      | 股票名称 | 民生银行    |
| stock_id   | varchar(10) | PK  | 股票代码 | 600016   |
| market     | varchar(10) | | 市场     | 沪A、深A、京A  |

```sql
CREATE TABLE ods_efinance_cnstock_list (
    stock_name    VARCHAR(20)   NOT NULL,
    stock_id      VARCHAR(10)   NOT NULL,
    market    VARCHAR(10)  NOT NULL,
    
    PRIMARY KEY (
        stock_id
    )
);
```

### ods_tushare_trade_cal

表：tushare 交易日历

| 字段名        | 类型        | 约束     | 说明                        | Sample Data |
| ------------- | ----------- | -------- | --------------------------- | ----------- |
| exchange      | varchar(10) | PK1      | 交易所 SSE上交所 SZSE深交所 | SSE         |
| cal_date      | varchar(8)  | PK2      | 交易日期                    | 20221102    |
| is_open       | varchar(1)  | NOT NULL | 是否交易 0休市 1交易        | 1           |
| pretrade_date | varchar(8)  | NOT NULL | 上一个交易日                | 20221101    |

```sql
CREATE TABLE ods_tushare_trade_cal (
    exchange    VARCHAR(10)   NOT NULL,
    cal_date	VARCHAR(8)   NOT NULL,
    is_open		VARCHAR(1)  NOT NULL,
    pretrade_date	VARCHAR(8)  NOT NULL,
    
    PRIMARY KEY (
        exchange, cal_date
    )
);
```

### ods_ds_stat

表：数据源数据统计表

| 字段名      | 类型         | 约束 | 说明          | Sample Data         |
| ----------- | ------------ | ---- | ------------- | ------------------- |
| ds_id       | varchar(50)  | PK   | 数据源ID      | tushare_stock_basic |
| ds_name     | varchar(50)  |      | 数据源名      | tushare股票基本信息 |
| start_bar   | varchar(20)  |      | 最早的Bar时间 |                     |
| end_bar     | varchar(20)  |      | 最新的Bar时间 |                     |
| missing_bar | varchar(500) |      | 缺少的Bar     | 20220101, 20221112  |
| notes       | varchar(500) |      | 备注          |                     |

```sql
CREATE TABLE ods_ds_stat (
    ds_id    VARCHAR(50)   NOT NULL,
    ds_name      VARCHAR(50) ,
    start_bar    VARCHAR(20) ,
    end_bar    VARCHAR(20) ,
    missing_bar    VARCHAR(500) ,
    notes    VARCHAR(500) ,
    
    PRIMARY KEY (
        ds_id
    )
);
```

### dwd_dtsrc_stat

表：数据源统计表

| 字段名      | 类型         | 约束 | 说明                          | Sample Data        |
| ----------- | ------------ | ---- | ----------------------------- | ------------------ |
| data_source | varchar(20)  | PK   | 数据源                        | baostock、efinance |
| start_dt    | varchar(20)  |      | 开始时间                      | 20000101           |
| end_dt      | varchar(20)  |      | 结束时间                      | 20220612           |
| error_msg   | varchar(200) |      | 问题描述，缺失时间点，用,分割 |                    |

```sql
CREATE TABLE dwd_dtsrc_stat (
    data_source    VARCHAR(20)   NOT NULL,
    start_dt      VARCHAR(10)   NOT NULL,
    end_dt      VARCHAR(10)   NOT NULL,
    error_msg    VARCHAR(200),
    
    PRIMARY KEY (
        data_source
    )
);
```

